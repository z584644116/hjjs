<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大气稳定度与监测适宜度计算器 (Pasquill-Turner法)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Microsoft YaHei', sans-serif;
        }
        .result-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 1.25rem;
            color: white;
            min-width: 100px;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-6 md:p-8 space-y-6">
        <!-- 头部信息 -->
        <div class="text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">大气稳定度与监测适宜度计算器</h1>
            <p class="text-gray-500 mt-2">依据《大气污染物无组织排放监测技术导则 HJ/T 55-2000》</p>
        </div>

        <!-- 输入区域 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 左侧输入 -->
            <div class="bg-gray-100 p-5 rounded-lg space-y-4">
                <h2 class="text-lg font-semibold text-gray-700 border-b pb-2">时间和地点</h2>
                <div>
                    <label for="date" class="block text-sm font-medium text-gray-600 mb-1">监测日期</label>
                    <input type="date" id="date" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="time" class="block text-sm font-medium text-gray-600 mb-1">北京时间</label>
                    <input type="time" id="time" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="latitude" class="block text-sm font-medium text-gray-600 mb-1">当地纬度 (°)</label>
                    <input type="number" id="latitude" placeholder="例如: 31.2" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="longitude" class="block text-sm font-medium text-gray-600 mb-1">当地经度 (°)</label>
                    <input type="number" id="longitude" placeholder="例如: 121.4" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>

            <!-- 右侧输入 -->
            <div class="bg-gray-100 p-5 rounded-lg space-y-4">
                 <h2 class="text-lg font-semibold text-gray-700 border-b pb-2">气象条件</h2>
                <div>
                    <label for="totalCloudCover" class="block text-sm font-medium text-gray-600 mb-1">总云量 (0-10成)</label>
                    <input type="number" id="totalCloudCover" min="0" max="10" placeholder="0-10的整数" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                 <div>
                    <label for="lowCloudCover" class="block text-sm font-medium text-gray-600 mb-1">低云量 (0-10成)</label>
                    <input type="number" id="lowCloudCover" min="0" max="10" placeholder="0-10的整数" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="windSpeedType" class="block text-sm font-medium text-gray-600 mb-1">风速测定方式</label>
                    <select id="windSpeedType" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="custom" selected>自定义高度风速</option>
                        <option value="10m">10米处风速</option>
                    </select>
                </div>
                <div id="customWindSpeedSection">
                    <div>
                        <label for="windSpeedHeight" class="block text-sm font-medium text-gray-600 mb-1">风速测定高度 (m)</label>
                        <input type="number" id="windSpeedHeight" value="2" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="terrainType" class="block text-sm font-medium text-gray-600 mb-1">下垫面类型</label>
                        <select id="terrainType" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="countryside">乡村</option>
                            <option value="city">城市</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- 适宜度输入 -->
        <div class="bg-gray-100 p-5 rounded-lg space-y-4">
            <h2 class="text-lg font-semibold text-gray-700 border-b pb-2">风向与风速连续读数 (10次)</h2>
            <p class="text-xs text-gray-500">输入10次连续读数以进行适宜度判定。计算将基于所有有效读数的平均值。</p>
            <div id="readingsContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-4 gap-y-3">
                <!-- 10 input pairs will be generated by JS -->
            </div>
        </div>


        <!-- 操作和结果 -->
        <div class="text-center">
            <button id="calculateBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 ease-in-out transform hover:scale-105">
                计算
            </button>
        </div>

        <!-- 结果展示区域 -->
        <div id="resultSection" class="hidden pt-6 border-t-2 border-dashed border-gray-200 space-y-4">
            <h2 class="text-xl font-bold text-center text-gray-800">计算结果</h2>
            <div class="flex flex-col md:flex-row items-center justify-center gap-4 p-4 bg-blue-50 rounded-lg">
                <span class="text-gray-700 text-lg">大气稳定度等级:</span>
                <div id="stabilityResult" class="result-badge"></div>
                <div id="stabilityDescription" class="text-lg font-medium text-gray-600"></div>
            </div>
             <div class="text-sm text-gray-500 p-4 bg-gray-100 rounded-lg">
                <h3 class="font-semibold mb-2">中间计算参数：</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <p>日期序数: <strong id="dayOfYearResult" class="text-gray-700"></strong></p>
                    <p>太阳倾角 (δ): <strong id="declinationResult" class="text-gray-700"></strong> °</p>
                    <p>太阳高度角 (h₀): <strong id="altitudeResult" class="text-gray-700"></strong> °</p>
                    <p>太阳辐射等级: <strong id="radiationResult" class="text-gray-700"></strong></p>
                </div>
                 <p class="mt-2">用于稳定度判定的10米风速(平均值): <strong id="windSpeed10mResult" class="text-gray-700"></strong> m/s</p>
            </div>
        </div>
        
        <!-- 适宜度结果 -->
        <div id="suitabilitySection" class="hidden pt-6 border-t-2 border-dashed border-gray-200 space-y-4">
            <h2 class="text-xl font-bold text-center text-gray-800">监测适宜度分析</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="p-4 bg-gray-50 rounded-lg border">
                    <h3 class="font-semibold text-gray-700">风向变化</h3>
                    <p class="text-sm text-gray-500">平均风向: <strong id="windDirAvgResult" class="text-gray-600"></strong></p>
                    <p class="text-sm text-gray-500">标准差: <strong id="windDirStdDevResult" class="text-gray-600"></strong> °</p>
                    <p id="windDirSuitability" class="text-2xl font-bold"></p>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg border">
                    <h3 class="font-semibold text-gray-700">平均风速</h3>
                    <p class="text-sm text-gray-500">10m平均值: <strong id="windSpeedAvgResult" class="text-gray-600"></strong> m/s</p>
                    <p id="windSpeedSuitability" class="text-2xl font-bold"></p>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg border">
                    <h3 class="font-semibold text-gray-700">大气稳定度</h3>
                    <p class="text-sm text-gray-500">等级: <strong id="stabilityClassForSuitability" class="text-gray-600"></strong></p>
                    <p id="stabilitySuitability" class="text-2xl font-bold"></p>
                </div>
            </div>
            <div id="overallSuitabilityContainer" class="p-6 bg-blue-100 rounded-lg text-center mt-4">
                 <h3 class="text-lg font-semibold text-blue-800">总适宜度判定</h3>
                 <p id="overallSuitability" class="text-3xl font-bold text-blue-900 mt-2"></p>
                 <p id="overallSuitabilityDesc" class="text-blue-700 mt-1"></p>
            </div>
        </div>

        <!-- 错误提示 -->
        <div id="errorSection" class="hidden text-center p-4 bg-red-100 text-red-700 rounded-lg">
            <p id="errorMessage"></p>
        </div>
    </div>

    <script>
        const stabilityDescriptions = {
            'A': '强不稳定', 'A-B': '不稳定', 'B': '不稳定',
            'B-C': '弱不稳定', 'C': '弱不稳定', 'D': '中性',
            'E': '较稳定', 'F': '稳定'
        };
        
        const stabilityColors = {
            'A': 'bg-red-600', 'A-B': 'bg-red-500', 'B': 'bg-orange-500',
            'B-C': 'bg-yellow-500', 'C': 'bg-yellow-400', 'D': 'bg-green-500',
            'E': 'bg-blue-500', 'F': 'bg-indigo-600'
        };
        
        const windProfileAlpha = {
            city: { 'A': 0.10, 'B': 0.15, 'C': 0.20, 'D': 0.25, 'E': 0.30, 'F': 0.30 },
            countryside: { 'A': 0.07, 'B': 0.07, 'C': 0.10, 'D': 0.15, 'E': 0.35, 'F': 0.35 }
        };

        const suitabilityInfo = {
            text: {'a': 'a 类', 'b': 'b 类', 'c': 'c 类', 'd': 'd 类'},
            desc: {
                'a': '不利于污染物的扩散和稀释, 适宜于进行无组织排放监测',
                'b': '较不利于污染物的扩散和稀释, 较适宜于进行无组织排放监测',
                'c': '有利于污染物的扩散和稀释, 较不适宜进行无组织排放监测',
                'd': '很有利于污染物的扩散和稀释, 不适宜进行无组织排放监测'
            },
            rank: { 'a': 1, 'b': 2, 'c': 3, 'd': 4 }
        };

        // --- Event Listeners and Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            setupReadingsInputs();
            setDefaultDateTime();

            document.getElementById('windSpeedType').addEventListener('change', (e) => {
                const customSection = document.getElementById('customWindSpeedSection');
                if (e.target.value === '10m') {
                    customSection.classList.add('hidden');
                } else {
                    customSection.classList.remove('hidden');
                }
            });

            document.getElementById('calculateBtn').addEventListener('click', runCalculation);
        });

        function setupReadingsInputs() {
            const container = document.getElementById('readingsContainer');
            let content = '';
            for (let i = 0; i < 10; i++) {
                content += `
                    <div class="space-y-1">
                        <label class="block text-xs font-medium text-gray-500">第 ${i + 1} 次</label>
                        <div class="flex gap-1">
                            <input type="number" id="dir-input-${i}" class="w-full p-1 text-sm border border-gray-300 rounded-md" placeholder="风向°">
                            <input type="number" step="0.1" id="speed-input-${i}" class="w-full p-1 text-sm border border-gray-300 rounded-md" placeholder="风速m/s">
                        </div>
                    </div>
                `;
            }
            container.innerHTML = content;
        }

        function runCalculation() {
            hideAllResults();

            // --- Get and Validate Inputs ---
            const inputs = getInputs();
            if (!inputs.valid) {
                showError(inputs.error);
                return;
            }

            const { dateInput, timeInput, lat, lon, totalCloud, lowCloud, speeds, directions } = inputs;
            const measuredWindSpeed = speeds.reduce((a, b) => a + b) / speeds.length;
            
            // --- Run Core Calculations ---
            const solarParams = calculateSolarParams(dateInput, timeInput, lat, lon, totalCloud, lowCloud);
            const stabilityParams = calculateStability(measuredWindSpeed, solarParams.radiationLevel);
            
            showStabilityResults({ ...solarParams, ...stabilityParams });
            
            // --- Run Suitability Calculation if possible ---
            if (directions.length >= 2) {
                const suitabilityParams = calculateSuitability(directions, stabilityParams.windSpeed10m, stabilityParams.stabilityClass);
                showSuitabilityResults(suitabilityParams);
            } else if (directions.length > 0) {
                showError("风向标准差计算需要至少2个读数，适宜度分析未执行。");
            }
        }

        // --- Helper Functions ---
        const toRadians = (deg) => deg * Math.PI / 180;
        const toDegrees = (rad) => rad * 180 / Math.PI;
        
        function calculateStdDev(arr) {
            const n = arr.length;
            if (n < 2) return 0;
            const mean = arr.reduce((a, b) => a + b) / n;
            const variance = arr.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / (n - 1); // Sample std dev for STDEV.S
            return Math.sqrt(variance);
        }
        
        function getWindDirectionDescription(angle) {
            const directions = [
                "北风", "东北偏北风", "东北风", "东北偏东风",
                "东风", "东南偏东风", "东南风", "东南偏南风",
                "南风", "西南偏南风", "西南风", "西南偏西风",
                "西风", "西北偏西风", "西北风", "西北偏北风"
            ];
            const normalizedAngle = (angle % 360 + 360) % 360;
            const index = Math.round(normalizedAngle / 22.5) % 16;
            return directions[index];
        }

        function calculateSolarParams(dateInput, timeInput, lat, lon, totalCloud, lowCloud) {
            const date = new Date(dateInput);
            const startOfYear = new Date(date.getFullYear(), 0, 0);
            const diff = date - startOfYear;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            
            const Qo = toRadians(360 * dayOfYear / 365);
            const solarDeclination = toDegrees(
                0.006918 - 0.399912 * Math.cos(Qo) + 0.070257 * Math.sin(Qo) -
                0.006758 * Math.cos(2 * Qo) + 0.00907 * Math.sin(2 * Qo) -
                0.002697 * Math.cos(3 * Qo) + 0.00148 * Math.sin(3 * Qo)
            );
            
            const [hour, minute] = timeInput.split(':').map(Number);
            const t = hour + minute / 60;
            const term1 = Math.sin(toRadians(lat)) * Math.sin(toRadians(solarDeclination));
            const term2 = Math.cos(toRadians(lat)) * Math.cos(toRadians(solarDeclination));
            const term3 = Math.cos(toRadians(15 * t + lon - 300));
            const solarAltitude = toDegrees(Math.asin(term1 + term2 * term3));
            
            const radiationLevel = getRadiationLevel(solarAltitude, totalCloud, lowCloud);
            return { dayOfYear, solarDeclination, solarAltitude, radiationLevel };
        }

        function getRadiationLevel(h0, totalCloud, lowCloud) {
            // Night
            if (h0 <= 0) {
                if (totalCloud <= 4) return -2;
                if (totalCloud <= 7) return -1;
                return 0;
            }
            // Daytime
            const h_range = [15, 35, 65, Infinity];
            const levels = {
                // cloud_condition: [h<=15, 15<h<=35, 35<h<=65, h>65]
                "low_cloud_clear":    [-1, 1, 2, 3], // total <= 4
                "low_cloud_scatter":  [0,  1, 2, 3], // 5 <= total <= 7, low <= 4
                "low_cloud_broken":   [0,  0, 1, 1], // total >= 8, low <= 4
                "mid_cloud_overcast": [0,  0, 0, 1], // 5 <= low <= 7
                "high_cloud_overcast":[0,  0, 0, 0]  // low >= 8
            };
            
            let cloud_condition;
            if (lowCloud <= 4) {
                if (totalCloud <= 4) cloud_condition = "low_cloud_clear";
                else if (totalCloud <= 7) cloud_condition = "low_cloud_scatter";
                else cloud_condition = "low_cloud_broken";
            } else if (lowCloud <= 7) {
                cloud_condition = "mid_cloud_overcast";
            } else {
                cloud_condition = "high_cloud_overcast";
            }

            const h_idx = h_range.findIndex(h => h0 <= h);
            return levels[cloud_condition][h_idx];
        }

        function getStabilityClass(windSpeed, radiationLevel) {
            const ws = windSpeed;
            if (ws < 1.9) {
                switch (radiationLevel) {
                    case 3: return 'A'; case 2: return 'A-B'; case 1: return 'B';
                    case 0: return 'D'; case -1: return 'E'; case -2: return 'F';
                }
            } else if (ws < 2.9) {
                switch (radiationLevel) {
                    case 3: return 'A-B'; case 2: return 'B'; case 1: return 'C';
                    case 0: return 'D'; case -1: return 'E'; case -2: return 'F';
                }
            } else if (ws < 6) { 
                 if (ws >= 3 && ws < 5) {
                     switch (radiationLevel) {
                        case 3: return 'B'; case 2: return 'B-C'; case 1: return 'C';
                        case 0: return 'D'; case -1: return 'D'; case -2: return 'E';
                    }
                 } else { // 5 <= ws < 6
                     switch (radiationLevel) {
                        case 3: return 'C'; case 2: 'C'; case 1: 'D';
                        default: return 'D';
                    }
                 }
            } else { // ws >= 6
                return 'D';
            }
            return 'D'; 
        }

        function calculateStability(measuredWindSpeed, radiationLevel) {
            const windSpeedType = document.getElementById('windSpeedType').value;
            let windSpeed10m = measuredWindSpeed;

            if (windSpeedType === 'custom') {
                const height = parseFloat(document.getElementById('windSpeedHeight').value);
                const terrain = document.getElementById('terrainType').value;
                if (!isNaN(height) && height > 0 && height !== 10) {
                    let preliminaryStability = getStabilityClass(measuredWindSpeed, radiationLevel);
                    let lookupClass = preliminaryStability.includes('-') ? preliminaryStability.split('-')[0] : preliminaryStability;
                    let alpha = windProfileAlpha[terrain][lookupClass];
                    windSpeed10m = measuredWindSpeed * Math.pow(10 / height, alpha);
                }
            }
            const stabilityClass = getStabilityClass(windSpeed10m, radiationLevel);
            return { windSpeed10m, stabilityClass };
        }

        function getWindDirSuitability(stdDev) {
            if (stdDev < 15) return 'a';
            if (stdDev < 30) return 'b';
            if (stdDev <= 45) return 'c';
            return 'd';
        }

        function getWindSpeedSuitability(avgSpeed) {
            if (avgSpeed < 1.0) return 'd'; // Per standard, < 1.0 m/s is quasi-still, but not suitable.
            if (avgSpeed <= 2.0) return 'a';
            if (avgSpeed <= 3.0) return 'b';
            if (avgSpeed <= 4.5) return 'c';
            return 'd';
        }

        function getStabilitySuitability(sClass) {
            if (sClass === 'E' || sClass === 'F') return 'a';
            if (sClass === 'D') return 'b';
            if (sClass === 'C' || sClass === 'B-C') return 'c';
            return 'd'; // A, A-B, B
        }

        function calculateSuitability(directions, windSpeed10m, stabilityClass) {
            const dirStdDev = calculateStdDev(directions);
            const meanDirection = directions.reduce((a, b) => a + b) / directions.length;
            const directionDescription = getWindDirectionDescription(meanDirection);
            
            const dirSuitability = getWindDirSuitability(dirStdDev);
            const speedSuitability = getWindSpeedSuitability(windSpeed10m);
            const stabilitySuitability = getStabilitySuitability(stabilityClass);

            const suitabilities = [dirSuitability, speedSuitability, stabilitySuitability];
            let worstSuitability = 'a';
            for (const s of suitabilities) {
                if (suitabilityInfo.rank[s] > suitabilityInfo.rank[worstSuitability]) {
                    worstSuitability = s;
                }
            }

            const c_count = suitabilities.filter(s => s === 'c').length;
            const d_count = suitabilities.filter(s => s === 'd').length;
            const shouldCancel = d_count > 0 || c_count >= 2;

            return {
                dirStdDev, meanDirection, directionDescription, dirSuitability,
                speedAvg: windSpeed10m, speedSuitability,
                stabilityClass, stabilitySuitability,
                overall: worstSuitability,
                shouldCancel
            };
        }

        // --- UI Update and Helper Functions ---
        function getInputs() {
            const dateInput = document.getElementById('date').value;
            const timeInput = document.getElementById('time').value;
            const lat = parseFloat(document.getElementById('latitude').value);
            const lon = parseFloat(document.getElementById('longitude').value);
            const totalCloud = parseInt(document.getElementById('totalCloudCover').value);
            const lowCloud = parseInt(document.getElementById('lowCloudCover').value);

            const directions = [];
            const speeds = [];
            for (let i = 0; i < 10; i++) {
                const dirVal = parseFloat(document.getElementById(`dir-input-${i}`).value);
                const speedVal = parseFloat(document.getElementById(`speed-input-${i}`).value);
                if (!isNaN(dirVal)) directions.push(dirVal);
                if (!isNaN(speedVal)) speeds.push(speedVal);
            }

            if (!dateInput || !timeInput || isNaN(lat) || isNaN(lon) || isNaN(totalCloud) || isNaN(lowCloud)) {
                return { valid: false, error: "时间和地点以及气象条件为必填项。" };
            }
             if (speeds.length === 0) {
                return { valid: false, error: "请至少输入一次有效的风速读数。" };
            }
            if (totalCloud < 0 || totalCloud > 10 || lowCloud < 0 || lowCloud > 10) {
                return { valid: false, error: "云量必须在0-10之间。" };
            }

            return { valid: true, dateInput, timeInput, lat, lon, totalCloud, lowCloud, directions, speeds };
        }

        function showStabilityResults(results) {
            document.getElementById('dayOfYearResult').textContent = results.dayOfYear;
            document.getElementById('declinationResult').textContent = results.solarDeclination.toFixed(2);
            document.getElementById('altitudeResult').textContent = results.solarAltitude.toFixed(2);
            document.getElementById('radiationResult').textContent = results.radiationLevel;
            document.getElementById('windSpeed10mResult').textContent = results.windSpeed10m.toFixed(2);
            
            const resultBadge = document.getElementById('stabilityResult');
            resultBadge.textContent = results.stabilityClass;
            resultBadge.className = 'result-badge'; 
            resultBadge.classList.add(stabilityColors[results.stabilityClass] || 'bg-gray-500');

            document.getElementById('stabilityDescription').textContent = stabilityDescriptions[results.stabilityClass] || '未知';
            document.getElementById('resultSection').classList.remove('hidden');
        }

        function showSuitabilityResults(results) {
            document.getElementById('windDirAvgResult').textContent = `${results.meanDirection.toFixed(1)}° (${results.directionDescription})`;
            document.getElementById('windDirStdDevResult').textContent = results.dirStdDev.toFixed(2);
            document.getElementById('windDirSuitability').textContent = suitabilityInfo.text[results.dirSuitability];
            
            document.getElementById('windSpeedAvgResult').textContent = results.speedAvg.toFixed(2);
            document.getElementById('windSpeedSuitability').textContent = suitabilityInfo.text[results.speedSuitability];

            document.getElementById('stabilityClassForSuitability').textContent = results.stabilityClass;
            document.getElementById('stabilitySuitability').textContent = suitabilityInfo.text[results.stabilitySuitability];

            const container = document.getElementById('overallSuitabilityContainer');
            const overallText = document.getElementById('overallSuitability');
            const overallDesc = document.getElementById('overallSuitabilityDesc');

            overallText.textContent = suitabilityInfo.text[results.overall];
            
            if (results.shouldCancel) {
                container.classList.remove('bg-blue-100');
                container.classList.add('bg-red-100');
                overallText.classList.remove('text-blue-900');
                overallText.classList.add('text-red-900');
                overallDesc.classList.remove('text-blue-700');
                overallDesc.classList.add('text-red-700');
                overallDesc.innerHTML = `${suitabilityInfo.desc[results.overall]}<br><strong class="mt-1 block">建议：应取消监测或改期</strong>`;
            } else {
                container.classList.remove('bg-red-100');
                container.classList.add('bg-blue-100');
                overallText.classList.remove('text-red-900');
                overallText.classList.add('text-blue-900');
                overallDesc.classList.remove('text-red-700');
                overallDesc.classList.add('text-blue-700');
                overallDesc.textContent = suitabilityInfo.desc[results.overall];
            }
            
            document.getElementById('suitabilitySection').classList.remove('hidden');
        }
        
        function hideAllResults() {
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('errorSection').classList.add('hidden');
            document.getElementById('suitabilitySection').classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorSection').classList.remove('hidden');
        }

        function setDefaultDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            
            document.getElementById('date').value = `${year}-${month}-${day}`;
            document.getElementById('time').value = `${hours}:${minutes}`;
        }
    </script>
</body>
</html>